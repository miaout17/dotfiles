#!/usr/bin/env ruby

require 'rubygems'

module Derails
  SCRIPT_RAILS = File.join('script', 'rails')

  def self.app_path
    @app_path ||= find_app_path
  end

  def self.find_app_path
    last_dir = Dir.pwd
    until in_app_path?
      Dir.chdir("..")
      return nil if Dir.pwd==last_dir
      last_dir = Dir.pwd
    end
    Dir.pwd
  rescue SystemCallError # Recure from chdir failure
    nil
  end

  def self.in_app_path?
    File.exists?(SCRIPT_RAILS)
  end
end

require "irb"
begin
  gem 'wirble'
  require 'wirble'
  Wirble.init
  Wirble.colorize
rescue LoadError
  puts "Wirble is not loaded!!"
end

begin
  gem 'hirb'
  require 'hirb'
  Hirb.enable
rescue LoadError
  puts "Hirb is not loaded!!"
end

APP_PATH = File.expand_path(File.join(Derails.app_path, "config/application"))
require File.expand_path(File.join(Derails.app_path, "config/boot"))
require 'rails/commands/console'
require APP_PATH

Rails.application.require_environment!
Rails::Console.start(Rails.application)

