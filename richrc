before(:setup_bundler) do
  # You can load extra gems here.

  require 'irb'

  # TODO: put some DSL into richrc?
  def self.try_gem(name, options={})
    # option[:require] = nil prevents require
    options[:require] = name unless options.has_key?(:require)

    begin
      gem(name)
      require(options[:require]) if options[:require]
      yield if block_given?
    rescue LoadError => e
      puts ".richrc: Failed to load #{name}"
      puts e
    end
  end

  try_gem 'wirble' do
    Wirble.init
    Wirble.colorize
  end

  try_gem 'hirb' do
    Hirb.enable
  end

  try_gem 'awesome_print', :require => 'ap'

end

after(:load_application) do
  # Doesn't enable by default, switch with ar_log method in my .irbrc
  # ActiveRecord::Base.logger = Logger.new(STDOUT)
end

